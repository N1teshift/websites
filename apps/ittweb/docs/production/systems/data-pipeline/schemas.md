# Data Pipeline Schemas

Complete documentation of all data structures generated by the pipeline.

## Overview

The pipeline generates TypeScript data files for three main entity types:
- **Items** - Game items (weapons, armor, potions, etc.)
- **Abilities** - Character abilities and spells
- **Units** - Game units (trolls, animals, buildings, etc.)

All generated files follow consistent type definitions and are located in `src/features/modules/guides/data/`.

---

## Item Data Schema

**Type:** `ItemData`  
**Location:** `src/types/items.ts`  
**Generated Files:** `src/features/modules/guides/data/items/*.ts`

### Structure

```typescript
type ItemData = {
  // Required fields
  id: string;                    // Slugified name (e.g., "sword-of-power")
  name: string;                  // Display name (e.g., "Sword of Power")
  category: ItemCategory;        // Primary category (see below)
  description: string;           // Item description text

  // Optional classification
  subcategory?: ItemSubcategory; // Secondary category (optional)

  // Display & visuals
  tooltip?: string;              // Extended tooltip from game data
  iconPath?: string;             // Icon filename (e.g., "BTNSword.png")

  // Cost information
  cost?: number;                 // Gold cost
  lumberCost?: number;           // Lumber/resource cost

  // Usage information
  hotkey?: string;               // Keyboard shortcut (e.g., "W")
  uses?: number;                 // Number of charges/uses
  hitPoints?: number;            // Item durability/hit points
  maxStack?: number;             // Maximum stack size

  // Stock information (shop items)
  stockMaximum?: number;         // Maximum stock at shops
  stockReplenishInterval?: number; // Stock replenish time (seconds)

  // Crafting
  recipe?: string[];             // Array of item IDs required to craft
  craftedAt?: string;            // Crafting location/recipe identifier
  mixingPotManaRequirement?: number; // Mana needed for mixing pot

  // Abilities
  abilities?: string[];          // Array of ability IDs granted by item

  // Stats and bonuses
  stats?: {
    damage?: number;
    armor?: number;
    health?: number;
    mana?: number;
    strength?: number;
    agility?: number;
    intelligence?: number;
    attackSpeed?: number;        // Attack speed bonus
    other?: string[];            // Additional stat descriptions
  };
};
```

### Item Categories

```typescript
type ItemCategory =
  | 'raw-materials'    // Basic crafting materials
  | 'weapons'          // Weapons and tools
  | 'armor'            // Armor pieces
  | 'potions'          // Consumable potions
  | 'scrolls'          // Scroll items
  | 'buildings'        // Buildable structures
  | 'unknown';         // Uncategorized items
```

### Item Subcategories

```typescript
type ItemSubcategory =
  | 'swords' | 'axes' | 'bows' | 'staffs' | 'fists'
  | 'helmets' | 'chest' | 'legs' | 'boots' | 'accessories'
  | 'healing' | 'mana' | 'buff' | 'debuff'
  | 'offensive' | 'defensive' | 'utility'
  | 'stat-management' | 'storage' | 'crafting'
  | 'defensive' | 'special-buildings';
```

### Example

```typescript
{
  id: 'sword-of-power',
  name: 'Sword of Power',
  category: 'weapons',
  subcategory: 'swords',
  description: 'A powerful sword that increases damage.',
  tooltip: 'Increases attack damage by 10.',
  iconPath: 'BTNSword.png',
  cost: 500,
  lumberCost: 50,
  hotkey: 'W',
  stats: {
    damage: 10,
    strength: 5
  },
  recipe: ['iron-ore', 'leather-strap'],
  craftedAt: 'blacksmith'
}
```

---

## Ability Data Schema

**Type:** `AbilityData`  
**Location:** `src/features/modules/guides/data/abilities/types.ts`  
**Generated Files:** `src/features/modules/guides/data/abilities/*.ts`

### Structure

```typescript
type AbilityData = {
  // Required fields
  id: string;                    // Slugified name (e.g., "fire-bolt")
  name: string;                  // Display name (e.g., "Fire Bolt")
  category: AbilityCategory;     // Ability category (see below)
  description: string;           // Ability description

  // Optional classification
  classRequirement?: string;     // Required class (e.g., "mage")

  // Display & visuals
  tooltip?: string;              // Extended tooltip from game data
  iconPath?: string;             // Icon filename

  // Combat stats
  manaCost?: number;             // Mana cost to cast
  cooldown?: number;             // Cooldown time (seconds)
  range?: number;                // Cast range
  duration?: number;             // Effect duration (seconds)
  damage?: string;               // Damage value (can be string for formulas)

  // Targeting & effects
  areaOfEffect?: number;         // AOE radius
  maxTargets?: number;           // Maximum number of targets
  targetsAllowed?: string;       // Target types (e.g., "enemy", "ally")
  effects?: string[];            // Array of effect descriptions

  // Usage
  hotkey?: string;               // Keyboard shortcut
  castTime?: number | string;    // Casting time

  // Class relationships
  availableToClasses?: string[]; // Classes that can use this ability
  spellbook?: 'hero' | 'normal' | string; // Spellbook type

  // Visual effects
  visualEffects?: unknown;       // Visual effect data

  // Level-specific data
  levels?: {
    [level: string]: {
      damage?: number | string;
      manaCost?: number;
      cooldown?: number;
      range?: number;
      areaOfEffect?: number;
      duration?: number;
      [key: string]: unknown;
    };
  };

  // Allow additional properties
  [key: string]: unknown;
};
```

### Ability Categories

```typescript
type AbilityCategory =
  | 'basic'          // Basic abilities (all classes)
  | 'hunter'         // Hunter class abilities
  | 'beastmaster'    // Beastmaster class abilities
  | 'mage'           // Mage class abilities
  | 'priest'         // Priest class abilities
  | 'thief'          // Thief class abilities
  | 'scout'          // Scout class abilities
  | 'gatherer'       // Gatherer class abilities
  | 'item'           // Item-granted abilities
  | 'building'       // Building abilities
  | 'bonushandler'   // Bonus handling abilities
  | 'buff'           // Buff abilities
  | 'auradummy'      // Aura dummy abilities
  | 'unknown';       // Uncategorized abilities
```

### Example

```typescript
{
  id: 'fire-bolt',
  name: 'Fire Bolt',
  category: 'mage',
  classRequirement: 'mage',
  description: 'Launches a bolt of fire at the target.',
  tooltip: 'Deals 100 damage to target enemy.',
  iconPath: 'BTNFireBolt.png',
  manaCost: 50,
  cooldown: 5,
  range: 600,
  damage: '100',
  hotkey: 'Q',
  targetsAllowed: 'enemy',
  availableToClasses: ['mage'],
  spellbook: 'normal',
  levels: {
    '1': { damage: 100, manaCost: 50 },
    '2': { damage: 150, manaCost: 60 },
    '3': { damage: 200, manaCost: 70 }
  }
}
```

---

## Unit Data Schema

**Type:** `UnitData`  
**Location:** `src/features/modules/guides/data/units/allUnits.ts`  
**Generated File:** `src/features/modules/guides/data/units/allUnits.ts`

### Structure

```typescript
type UnitData = {
  // Required fields
  id: string;                    // Unit ID (raw ID or slugified name)
  name: string;                  // Display name
  type: UnitType;                // Unit type classification (see below)

  // Optional display
  description?: string;           // Unit description
  tooltip?: string;              // Extended tooltip
  iconPath?: string;             // Icon filename

  // Classification
  race?: string;                 // Unit race (e.g., "commoner")
  classification?: string;       // Unit classification

  // Combat stats
  hp?: number;                   // Hit points / health
  mana?: number;                 // Mana points
  armor?: number;                // Armor value
  damage?: number;               // Damage value (-1 for no damage)
  moveSpeed?: number;            // Movement speed
  attackSpeed?: number;          // Attack speed

  // Crafting (for buildings)
  craftableItems?: string[];     // Array of item IDs that can be crafted
};
```

### Unit Types

```typescript
type UnitType =
  | 'troll'                      // Playable troll characters
  | 'animal'                     // Animal units
  | 'boss'                       // Boss enemies
  | 'building'                   // Buildings and structures
  | 'unit-dummy-item-reward'     // Item reward dummy units
  | 'dummy'                      // Dummy/effect units
  | 'other';                     // Other unit types
```

### Example

```typescript
{
  id: 'hunter-base',
  name: 'Hunter',
  type: 'troll',
  description: 'A skilled hunter troll.',
  tooltip: 'Ranged combat specialist.',
  iconPath: 'BTNHunter.png',
  race: 'troll',
  hp: 500,
  mana: 200,
  armor: 2,
  damage: 25,
  moveSpeed: 320,
  attackSpeed: 1.5
}
```

---

## Classes Schema

**Types:** `BaseClass` and `DerivedClass`  
**Location:** `src/features/modules/guides/data/units/classes.ts` and `derivedClasses.ts`

### Base Class Structure

```typescript
type BaseClass = {
  id: string;                    // Class ID (slugified)
  name: string;                  // Class name
  description?: string;          // Class description
  iconPath?: string;             // Class icon
  // ... additional fields
};
```

### Derived Class Structure

```typescript
type DerivedClass = {
  id: string;                    // Derived class ID
  name: string;                  // Class name
  baseClass: string;             // Parent class ID
  description?: string;          // Class description
  iconPath?: string;             // Class icon
  // ... additional fields
};
```

---

## Icon Mapping Schema

**Type:** `IconMap`  
**Location:** `src/features/modules/guides/data/iconMap.ts`

### Structure

```typescript
type IconMap = {
  abilities: { [entityName: string]: string };  // Ability name → icon filename
  items: { [entityName: string]: string };      // Item name → icon filename
  buildings: { [entityName: string]: string };  // Building name → icon filename
  trolls: { [entityName: string]: string };     // Troll/class name → icon filename
  units: { [entityName: string]: string };      // Unit name → icon filename
};
```

### Example

```typescript
{
  abilities: {
    'Fire Bolt': 'BTNFireBolt.png',
    'Ice Shard': 'BTNIceShard.png'
  },
  items: {
    'Sword of Power': 'BTNSword.png',
    'Health Potion': 'BTNHealthPotion.png'
  },
  // ... etc
}
```

---

## Ability ID Mapper Schema

**Type:** `AbilityIdMapper`  
**Location:** `src/features/modules/guides/data/items/abilityIdMapper.ts`

### Structure

Maps raw ability IDs (from game files) to ability slugs:

```typescript
type AbilityIdMapper = {
  [rawAbilityId: string]: string;  // Raw ID (e.g., "AMi1") → slug (e.g., "fire-bolt")
};
```

### Example

```typescript
{
  'AMi1': 'fire-bolt',
  'A00L': 'ice-shard',
  'AMd5': 'heal'
}
```

---

## Intermediate JSON Schemas

These are temporary files in `tmp/work-data/` used during processing.

### Raw Extraction (`tmp/work-data/raw/`)

**Files:**
- `items.json` - Raw item data from war3map.w3t
- `abilities.json` - Raw ability data from war3map.w3a
- `units.json` - Raw unit data from war3map.w3u
- `buildings.json` - Raw building data from war3map.w3b

**Structure:** Contains raw object data with all fields from game files.

### Metadata (`tmp/work-data/metadata/`)

**Files:**
- `recipes.json` - Recipe definitions from war3map.j
- `units.json` - Processed unit metadata
- `buildings.json` - Processed building metadata
- `ability-details-wurst.json` - Enhanced ability details from Wurst source
- `ability-relationships.json` - Ability-to-class relationships
- `item-details-wurst.json` - Enhanced item details from Wurst source

---

## Data Flow

1. **Raw Extraction** → JSON files in `tmp/work-data/raw/`
2. **Metadata Extraction** → JSON files in `tmp/work-data/metadata/`
3. **Conversion** → TypeScript files in `src/features/modules/guides/data/`
4. **Post-processing** → Icon mapping, field resolution, path fixing

---

## Field Naming Conventions

- **IDs**: Always slugified (lowercase, hyphens, e.g., `sword-of-power`)
- **Names**: Display names with proper capitalization
- **Paths**: Relative paths only (e.g., `BTNSword.png`, not `/icons/itt/BTNSword.png`)
- **Optional fields**: Use `?` in TypeScript, check for existence in code

---

## Related Documentation

- [Pipeline Architecture](./architecture.md) - How data flows through the pipeline
- [Troubleshooting](./troubleshooting.md) - Common issues with data structures
- [Main Pipeline README](../../../scripts/README.md) - Operational guide

