# Internationalization (i18n) Guide

**Complete guide to internationalization in @websites/infrastructure**

## Overview

The i18n module provides internationalization utilities for Next.js applications with namespace support and fallback mechanisms.

## Quick Start

```typescript
import { useFallbackTranslation } from '@websites/infrastructure/i18n';

function MyComponent() {
  const { t } = useFallbackTranslation();
  return <h1>{t('welcome')}</h1>;
}
```

## Core Principles

### 1. Namespace Strategy

Each page defines namespaces in order: `[feature-specific, "links", "common"]`

**Examples:**
- Feature pages: `["calendar", "links", "common"]`
- Simple pages: `["links", "common"]`

### 2. Translation Context

- `Layout` provides `TranslationNamespaceContext` to all children
- All components use `useFallbackTranslation()` hook
- Pass `pageTranslationNamespaces` through component hierarchy

## Implementation Patterns

### Page Structure

```typescript
import { getStaticPropsWithTranslations } from '@websites/infrastructure/i18n';

const pageNamespaces = ["calendar", "links", "common"];
export const getStaticProps = getStaticPropsWithTranslations(pageNamespaces);

export default function LessonSchedulerPage() {
    // Feature flag check
    if (!isFeatureEnabled('lessonScheduler')) {
        return (
            <UnderConstructionPage
                titleKey="lesson_scheduler"
                pageTranslationNamespaces={pageNamespaces}
                messageKey="lesson_scheduler_disabled"
            />
        );
    }

    return (
        <LessonSchedulerLayout pageTranslationNamespaces={pageNamespaces}>
            {/* Feature-specific content */}
        </LessonSchedulerLayout>
    );
}
```

### Translation Usage

**1. Child Components (Most Common)**
```typescript
const { t } = useFallbackTranslation();
return <h1>{t("lesson_scheduler")}</h1>;
```

**2. Page-Level (Before Layout)**
```typescript
const { t } = useFallbackTranslation(pageTranslationNamespaces);
return <p>{t("lesson_scheduler_disabled")}</p>;
```

**3. Simple Pages**
```typescript
export default function Home() {
    return (
        <Layout pageTranslationNamespaces={pageNamespaces}>
            <CenteredLinkGrid links={links} />
        </Layout>
    );
}
```

## API Reference

### `useFallbackTranslation(namespaces?: string[])`

Hook with fallback namespace support.

**Parameters:**
- `namespaces` (string[], optional) - Translation namespaces. If not provided, uses context.

**Returns:** `{ t: (key: string) => string }`

**Example:**
```typescript
const { t } = useFallbackTranslation();
const title = t('page_title');
```

### `TranslationNamespaceContext`

React context for translation namespaces.

**Usage:**
```typescript
import { TranslationNamespaceContext } from '@websites/infrastructure/i18n';

<TranslationNamespaceContext.Provider value={namespaces}>
  {children}
</TranslationNamespaceContext.Provider>
```

### `useTranslationNamespace()`

Hook to access translation namespace context.

**Returns:** Current namespaces from context

### `getStaticPropsWithTranslations(namespaces: string[])`

Helper for Next.js getStaticProps.

**Parameters:**
- `namespaces` (string[], required) - Translation namespaces to load

**Returns:** getStaticProps function

**Example:**
```typescript
export const getStaticProps = getStaticPropsWithTranslations(['common', 'links']);
```

### `nextI18NextConfig`

Base next-i18next configuration.

**Usage:**
```typescript
import { nextI18NextConfig } from '@websites/infrastructure/i18n';

// Use in your next-i18next.config.js
export default nextI18NextConfig;
```

## Rules for Development

1. **Always define `pageNamespaces` at page top**
2. **Pass `pageTranslationNamespaces` to all components that need translations**
3. **Use `useFallbackTranslation()` for all translations**
4. **Child components inherit context, no parameters needed**
5. **Page-level translations need explicit namespaces**
6. **Feature flags use same namespaces as enabled state**

## Translation File Structure

```
locales/
├── en/
│   ├── common.json
│   ├── links.json
│   └── [feature].json
├── lt/
│   ├── common.json
│   ├── links.json
│   └── [feature].json
└── ru/
    ├── common.json
    ├── links.json
    └── [feature].json
```

## Best Practices

### 1. Namespace Organization

- `common.json` - Shared translations across all pages
- `links.json` - Navigation and link labels
- `[feature].json` - Feature-specific translations

### 2. Key Naming

Use snake_case for translation keys:
```json
{
  "page_title": "Welcome",
  "user_name": "User Name",
  "submit_button": "Submit"
}
```

### 3. Context Usage

Always use context when possible:
```typescript
// ✅ Good - uses context
const { t } = useFallbackTranslation();

// ⚠️ Only when context not available
const { t } = useFallbackTranslation(['common', 'links']);
```

## Related Documentation

- [i18n Module API Reference](../src/i18n/README.md) - Complete API reference
- [Getting Started Guide](./getting-started.md) - Initial setup
